<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>OpenSSL WASM Encrypt/Decrypt Demo</title>
</head>
<body>
    <h1>OpenSSL WASM Encrypt/Decrypt Demo</h1>

    <label>
        Input text:<br />
        <textarea id="inputText" rows="4" cols="50">Hello WebAssembly!</textarea>
    </label><br /><br />

    <button id="encryptBtn">Encrypt</button><br /><br />

    <label>
        Encrypted (Base64):<br />
        <textarea id="encryptedText" rows="4" cols="50" readonly></textarea>
    </label><br /><br />

    <button id="decryptBtn">Decrypt</button><br /><br />

    <label>
        Decrypted text:<br />
        <textarea id="decryptedText" rows="4" cols="50" readonly></textarea>
    </label>

    <script>
        // Wait for the wasm module to initialize
        Module.onRuntimeInitialized = () => {
            const encrypt = Module.encrypt;
            const decrypt = Module.decrypt;

            const inputEl = document.getElementById('inputText');
            const encryptedEl = document.getElementById('encryptedText');
            const decryptedEl = document.getElementById('decryptedText');
            const encryptBtn = document.getElementById('encryptBtn');
            const decryptBtn = document.getElementById('decryptBtn');

            let lastEncrypted = '';

            encryptBtn.onclick = () => {
                const plainText = inputEl.value;
                // Call encrypt; assuming encrypt takes and returns string (adjust if needed)
                lastEncrypted = encrypt(plainText, "key123", "salt123");
                // Encode binary to base64 for display
                const base64Enc = btoa(lastEncrypted);
                encryptedEl.value = base64Enc;
            };

            decryptBtn.onclick = () => {
                const base64Enc = encryptedEl.value;
                try {
                    const encryptedData = atob(base64Enc);
                    const decrypted = decrypt(encryptedData, "key123", "salt123");
                    decryptedEl.value = decrypted;
                } catch (e) {
                    alert("Decryption failed or invalid input");
                }
            };
        };
    </script>
    {{SCRIPT}} <!-- Your generated JS glue code -->
</body>
</html>
